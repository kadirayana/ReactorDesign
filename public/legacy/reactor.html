<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reaktör Tasarım ve Görselleştirme</title>
    <link rel="stylesheet" href="responsive.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        .container {
            background: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 100%;
            margin: 80px auto 20px;
        }
        /* ...existing code... */
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        h2 {
            color: #343a40;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            display: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        table, th, td {
            border: 1px solid #dee2e6;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #e9ecef;
        }
        .reactor-diagram {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            text-align: center;
        }
        canvas {
            max-width: 100%;
            margin-top: 20px;
        }
        .tabs {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 5px 5px 0 0;
        }
        .tabs button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 12px 16px;
            transition: 0.3s;
            color: #495057;
        }
        .tabs button:hover {
            background-color: #ddd;
        }
        .tabs button.active {
            background-color: #007bff;
            color: white;
        }
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
    </style>
</head>
<body>

    <!-- header/navbar removed -->
    <div class="container">
        <div class="content">
            <h2>Reaktör Tasarım ve Görselleştirme</h2>
            
            <div class="tabs">
                <button class="tablinks active" onclick="openTab(event, 'basicDesign')">Temel Tasarım</button>
                <button class="tablinks" onclick="openTab(event, 'advancedDesign')">Gelişmiş Tasarım</button>
                <button class="tablinks" onclick="openTab(event, 'economicAnalysis')">Ekonomik Analiz</button>
            </div>
            
            <div id="basicDesign" class="tabcontent" style="display: block;">
                <h3>Temel Reaktör Parametreleri</h3>
                
                <label for="reactorType">Reaktör Tipi:</label>
                <select id="reactorType" onchange="updateReactorInputs()">
                    <option value="pfr">Plug Flow Reactor (PFR)</option>
                    <option value="cstr">Continuous Stirred Tank Reactor (CSTR)</option>
                    <option value="pbr">Packed Bed Reactor (PBR)</option>
                    <option value="batch">Batch Reactor</option>
                </select>
                
                <label for="reactionOrder">Reaksiyon Derecesi:</label>
                <select id="reactionOrder">
                    <option value="0">Sıfırıncı Derece</option>
                    <option value="1" selected>Birinci Derece</option>
                    <option value="2">İkinci Derece</option>
                    <option value="custom">Özel Kinetiğe Göre</option>
                </select>
                
                <div id="customKinetics" style="display: none;">
                    <label for="kineticEquation">Kinetik Denklem (örn. k*CA*CB/(1+K*CA)):</label>
                    <input type="text" id="kineticEquation" placeholder="k*CA*CB/(1+K*CA)">
                    
                    <label for="inhibitionConstant">İnhibisyon Sabiti (K):</label>
                    <input type="number" id="inhibitionConstant" step="0.01" min="0" value="0">
                </div>
                
                <label for="flowRate">Mol Akış Hızı, F<sub>A0</sub> [mol/s]:</label>
                <input type="number" id="flowRate" step="0.1" min="0" value="10">
                
                <label for="initialConcentration">Başlangıç Konsantrasyonu, C<sub>A0</sub> [mol/m³]:</label>
                <input type="number" id="initialConcentration" step="1" min="0" value="100">
                
                <label for="rateConstant">Hız Sabiti, k [1/s]:</label>
                <input type="number" id="rateConstant" step="0.001" min="0" value="0.05">
                
                <div id="catParams" style="display: none;">
                    <label for="catDensity">Katalizör Yoğunluğu [kg/m³]:</label>
                    <input type="number" id="catDensity" step="10" min="0" value="1000">
                    
                    <label for="effectiveRateConstant">Katalizöre Özgü Hız Sabiti, k<sub>eff</sub> [1/s.kg]:</label>
                    <input type="number" id="effectiveRateConstant" step="0.001" min="0" value="0.1">
                    
                    <label for="effectivenessFactor">Etkinlik Faktörü (η):</label>
                    <input type="number" id="effectivenessFactor" step="0.01" min="0" max="1" value="0.8">
                </div>
                
                <label for="targetConversion">Hedef Dönüşüm, X (0 < X < 1):</label>
                <input type="number" id="targetConversion" step="0.01" min="0.01" max="0.99" value="0.8">
                
                <button onclick="calculateBasicReactor()">Hesapla ve Görselleştir</button>
            </div>
            
            <div id="advancedDesign" class="tabcontent">
                <h3>Gelişmiş Reaktör Parametreleri</h3>
                
                <label for="reactionType">Reaksiyon Tipi:</label>
                <select id="reactionType">
                    <option value="irreversible">Tersinmez (A → B)</option>
                    <option value="reversible">Tersinir (A ⇌ B)</option>
                    <option value="parallel">Paralel (A → B, A → C)</option>
                    <option value="series">Seri (A → B → C)</option>
                </select>
                
                <div id="thermodynamicParams">
                    <h4>Termodinamik Parametreler</h4>
                    
                    <label for="reactionTemp">Reaksiyon Sıcaklığı [K]:</label>
                    <input type="number" id="reactionTemp" step="1" min="273" value="350">
                    
                    <label for="reactionPressure">Reaksiyon Basıncı [bar]:</label>
                    <input type="number" id="reactionPressure" step="0.1" min="0.1" value="2">
                    
                    <label for="activationEnergy">Aktivasyon Enerjisi [kJ/mol]:</label>
                    <input type="number" id="activationEnergy" step="1" min="0" value="80">
                    
                    <label for="heatOfReaction">Reaksiyon Isısı [kJ/mol]:</label>
                    <input type="number" id="heatOfReaction" step="1" value="-50">
                </div>
                
                <div id="massTransferParams">
                    <h4>Kütle Transfer Parametreleri</h4>
                    
                    <label for="externalDiffusion">Dış Difüzyon Direnci Dahil:</label>
                    <input type="checkbox" id="externalDiffusion">
                    
                    <label for="internalDiffusion">İç Difüzyon Direnci Dahil:</label>
                    <input type="checkbox" id="internalDiffusion">
                    
                    <label for="thieleMod">Thiele Modülü:</label>
                    <input type="number" id="thieleMod" step="0.1" min="0" value="1.0" disabled>
                </div>
                
                <div id="heatTransferParams">
                    <h4>Isı Transfer Parametreleri</h4>
                    
                    <label for="operatingMode">Çalışma Modu:</label>
                    <select id="operatingMode">
                        <option value="isothermal">İzotermal</option>
                        <option value="adiabatic">Adyabatik</option>
                        <option value="nonisothermal">İzotermal Olmayan</option>
                    </select>
                    
                    <label for="coolingMethod">Soğutma Metodu:</label>
                    <select id="coolingMethod" disabled>
                        <option value="jacket">Ceket</option>
                        <option value="coil">Sarmal Boru</option>
                        <option value="exchanger">Isı Değiştirici</option>
                    </select>
                    
                    <label for="heatTransferCoeff">Isı Transfer Katsayısı [W/(m²·K)]:</label>
                    <input type="number" id="heatTransferCoeff" step="10" min="0" value="500" disabled>
                </div>
                
                <button onclick="calculateAdvancedReactor()">Gelişmiş Hesaplama</button>
            </div>
            
            <div id="economicAnalysis" class="tabcontent">
                <h3>Ekonomik Analiz Parametreleri</h3>
                
                <label for="capitalCost">Yatırım Maliyeti [USD]:</label>
                <input type="number" id="capitalCost" step="1000" min="0" value="500000">
                
                <label for="operatingCost">İşletme Maliyeti [USD/yıl]:</label>
                <input type="number" id="operatingCost" step="1000" min="0" value="50000">
                
                <label for="rawMaterialCost">Hammadde Maliyeti [USD/ton]:</label>
                <input type="number" id="rawMaterialCost" step="10" min="0" value="200">
                
                <label for="productValue">Ürün Değeri [USD/ton]:</label>
                <input type="number" id="productValue" step="10" min="0" value="500">
                
                <label for="projectLife">Proje Ömrü [yıl]:</label>
                <input type="number" id="projectLife" step="1" min="1" value="10">
                
                <label for="discountRate">İskonto Oranı [%]:</label>
                <input type="number" id="discountRate" step="0.5" min="0" max="100" value="10">
                
                <button onclick="calculateEconomics()">Ekonomik Analiz Yap</button>
            </div>
            
            <div id="results" class="results">
                <h3>Reaktör Tasarım Sonuçları</h3>
                <div id="resultsContent"></div>
                
                <div id="reactorPerformance">
                    <h4>Performans Parametreleri</h4>
                    <table id="performanceTable">
                        <tr>
                            <th>Parametre</th>
                            <th>Değer</th>
                            <th>Birim</th>
                        </tr>
                        <tr>
                            <td>Reaktör Hacmi/Uzunluğu</td>
                            <td id="reactorVolume">-</td>
                            <td id="volumeUnit">m³ veya m</td>
                        </tr>
                        <tr>
                            <td>Uzay Zamanı</td>
                            <td id="spaceTime">-</td>
                            <td>s</td>
                        </tr>
                        <tr>
                            <td>Uzay Hızı</td>
                            <td id="spaceVelocity">-</td>
                            <td>1/s</td>
                        </tr>
                        <tr>
                            <td>Dönüşüm</td>
                            <td id="conversion">-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Seçicilik</td>
                            <td id="selectivity">-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Verim</td>
                            <td id="yield">-</td>
                            <td>-</td>
                        </tr>
                    </table>
                </div>
                
                <div id="economicResults" style="display: none;">
                    <h4>Ekonomik Analiz Sonuçları</h4>
                    <table id="economicTable">
                        <tr>
                            <th>Gösterge</th>
                            <th>Değer</th>
                        </tr>
                        <tr>
                            <td>Net Bugünkü Değer (NPV)</td>
                            <td id="npvValue">-</td>
                        </tr>
                        <tr>
                            <td>İç Karlılık Oranı (IRR)</td>
                            <td id="irrValue">-</td>
                        </tr>
                        <tr>
                            <td>Geri Ödeme Süresi</td>
                            <td id="paybackValue">-</td>
                        </tr>
                        <tr>
                            <td>Yatırımın Geri Dönüş Oranı (ROI)</td>
                            <td id="roiValue">-</td>
                        </tr>
                    </table>
                </div>
                
                <div id="reactorDiagram" class="reactor-diagram">
                    <h4>Reaktör Şeması</h4>
                    <div id="diagramContainer"></div>
                </div>
                
                <h4>Performans Grafikleri</h4>
                <div class="tabs">
                    <button class="tablinks active" onclick="openChartTab(event, 'conversionChart')">Dönüşüm</button>
                    <button class="tablinks" onclick="openChartTab(event, 'concentrationChart')">Konsantrasyon</button>
                    <button class="tablinks" onclick="openChartTab(event, 'temperatureChart')">Sıcaklık</button>
                </div>
                
                <div id="conversionChart" class="tabcontent" style="display: block;">
                    <canvas id="conversionCanvas" width="800" height="400"></canvas>
                </div>
                
                <div id="concentrationChart" class="tabcontent">
                    <canvas id="concentrationCanvas" width="800" height="400"></canvas>
                </div>
                
                <div id="temperatureChart" class="tabcontent">
                    <canvas id="temperatureCanvas" width="800" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let conversionChart = null;
        let concentrationChart = null;
        let temperatureChart = null;
        
        function updateReactorInputs() {
            const reactorType = document.getElementById('reactorType').value;
            const catParams = document.getElementById('catParams');
            
            // Katalizörlü reaktörler için ek parametreleri göster
            if (reactorType === 'pbr') {
                catParams.style.display = 'block';
            } else {
                catParams.style.display = 'none';
            }
            
            // Reaksiyon derecesi özel ise kinetik denklemi göster
            document.getElementById('reactionOrder').addEventListener('change', function() {
                const customKinetics = document.getElementById('customKinetics');
                if (this.value === 'custom') {
                    customKinetics.style.display = 'block';
                } else {
                    customKinetics.style.display = 'none';
                }
            });
            
            // Çalışma modu izotermal olmayan ise soğutma parametrelerini etkinleştir
            document.getElementById('operatingMode').addEventListener('change', function() {
                const coolingMethod = document.getElementById('coolingMethod');
                const heatTransferCoeff = document.getElementById('heatTransferCoeff');
                
                if (this.value === 'nonisothermal') {
                    coolingMethod.disabled = false;
                    heatTransferCoeff.disabled = false;
                } else {
                    coolingMethod.disabled = true;
                    heatTransferCoeff.disabled = true;
                }
            });
            
            // Difüzyon direnci etkinleştirilirse Thiele modülünü hesapla
            const externalDiffusion = document.getElementById('externalDiffusion');
            const internalDiffusion = document.getElementById('internalDiffusion');
            const thieleMod = document.getElementById('thieleMod');
            
            externalDiffusion.addEventListener('change', updateThieleModule);
            internalDiffusion.addEventListener('change', updateThieleModule);
            
            function updateThieleModule() {
                if (internalDiffusion.checked) {
                    thieleMod.disabled = false;
                } else {
                    thieleMod.disabled = true;
                }
            }
        }
        
        function openTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            
            const tablinks = document.getElementsByClassName("tablinks");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        
        function openChartTab(evt, chartName) {
            const chartTabs = document.querySelectorAll('.reactor-diagram + h4 + .tabs + .tabcontent');
            for (let i = 0; i < chartTabs.length; i++) {
                chartTabs[i].style.display = "none";
            }
            
            const chartLinks = document.querySelectorAll('.reactor-diagram + h4 + .tabs .tablinks');
            for (let i = 0; i < chartLinks.length; i++) {
                chartLinks[i].className = chartLinks[i].className.replace(" active", "");
            }
            
            document.getElementById(chartName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        
        function calculateBasicReactor() {
            // Girdi verilerini al
            const reactorType = document.getElementById('reactorType').value;
            const reactionOrder = parseInt(document.getElementById('reactionOrder').value);
            const flowRate = parseFloat(document.getElementById('flowRate').value);
            const initialConc = parseFloat(document.getElementById('initialConcentration').value);
            const rateConstant = parseFloat(document.getElementById('rateConstant').value);
            const targetConversion = parseFloat(document.getElementById('targetConversion').value);
            
            let reactorVolume = 0;
            let spaceTime = 0;
            let spaceVelocity = 0;
            
            // Reaktör hacmini hesapla
            switch(reactorType) {
                case 'pfr':
                    // PFR için hacim hesabı (r = k*CA^n)
                    if (reactionOrder === 1) {
                        // Birinci derece kinetik
                        reactorVolume = (flowRate/initialConc) * Math.log(1/(1-targetConversion)) / rateConstant;
                    } else if (reactionOrder === 2) {
                        // İkinci derece kinetik
                        reactorVolume = (flowRate/initialConc) * (1/(1-targetConversion) - 1) / (rateConstant * initialConc);
                    } else {
                        // Sıfırıncı derece kinetik
                        reactorVolume = (flowRate * targetConversion) / (rateConstant * initialConc);
                    }
                    break;
                    
                case 'cstr':
                    // CSTR için hacim hesabı
                    if (reactionOrder === 1) {
                        reactorVolume = (flowRate * targetConversion) / (rateConstant * initialConc * (1 - targetConversion));
                    } else if (reactionOrder === 2) {
                        reactorVolume = (flowRate * targetConversion) / (rateConstant * Math.pow(initialConc * (1 - targetConversion), 2));
                    } else {
                        reactorVolume = (flowRate * targetConversion) / rateConstant;
                    }
                    break;
                    
                case 'pbr':
                    // PBR için - Burada basitleştirilmiş bir model kullanılıyor
                    const catDensity = parseFloat(document.getElementById('catDensity').value);
                    const effectiveRateConstant = parseFloat(document.getElementById('effectiveRateConstant').value);
                    const effectivenessFactor = parseFloat(document.getElementById('effectivenessFactor').value);
                    
                    if (reactionOrder === 1) {
                        reactorVolume = (flowRate/initialConc) * Math.log(1/(1-targetConversion)) / 
                            (effectiveRateConstant * effectivenessFactor * catDensity);
                    } else if (reactionOrder === 2) {
                        reactorVolume = (flowRate/initialConc) * (1/(1-targetConversion) - 1) / 
                            (effectiveRateConstant * effectivenessFactor * catDensity * initialConc);
                    } else {
                        reactorVolume = (flowRate * targetConversion) / 
                            (effectiveRateConstant * effectivenessFactor * catDensity);
                    }
                    break;
                    
                case 'batch':
                    // Batch reaktör için reaksiyon süresi hesaplama
                    if (reactionOrder === 1) {
                        reactorVolume = Math.log(1/(1-targetConversion)) / rateConstant; // Burada hacim yerine süre
                    } else if (reactionOrder === 2) {
                        reactorVolume = (1/(1-targetConversion) - 1) / (rateConstant * initialConc);
                    } else {
                        reactorVolume = targetConversion / (rateConstant * initialConc);
                    }
                    break;
            }
            
            // Uzay zamanı ve uzay hızı hesaplamaları
            if (reactorType === 'batch') {
                spaceTime = reactorVolume; // Batch reaktörde reaksiyon süresi
                spaceVelocity = 1 / spaceTime;
            } else {
                spaceTime = reactorVolume * initialConc / flowRate;
                spaceVelocity = 1 / spaceTime;
            }
            
            // Performans değerlendirmesi - Basitleştirilmiş
            const selectivity = 0.95; // Varsayılan değer
            const yield = targetConversion * selectivity;
            
            // Sonuçları göster
            document.getElementById('results').style.display = 'block';
            
            if (reactorType === 'batch') {
                document.getElementById('reactorVolume').textContent = reactorVolume.toFixed(2);
                document.getElementById('volumeUnit').textContent = 'saat';
            } else {
                document.getElementById('reactorVolume').textContent = reactorVolume.toFixed(2);
                document.getElementById('volumeUnit').textContent = (reactorType === 'pfr') ? 'm³ (veya m uzunluk)' : 'm³';
            }
            
            document.getElementById('spaceTime').textContent = spaceTime.toFixed(2);
            document.getElementById('spaceVelocity').textContent = spaceVelocity.toFixed(4);
            document.getElementById('conversion').textContent = targetConversion.toFixed(2);
            document.getElementById('selectivity').textContent = selectivity.toFixed(2);
            document.getElementById('yield').textContent = yield.toFixed(2);
            
            document.getElementById('resultsContent').innerHTML = `
                <p><strong>Reaktör Tipi:</strong> ${getReactorName(reactorType)}</p>
                <p><strong>Reaksiyon Derecesi:</strong> ${reactionOrder}</p>
                <p><strong>Hız Sabiti:</strong> ${rateConstant} 1/s</p>
                <p><strong>Hedef Dönüşüm:</strong> ${(targetConversion*100).toFixed(1)}%</p>
            `;
            
            // Reaktör şemasını çiz
            drawReactorDiagram(reactorType);
            
            // Dönüşüm grafiğini çiz
            drawConversionProfile(reactorType, reactionOrder, rateConstant, initialConc, flowRate);
            
            // Konsantrasyon grafiğini çiz
            drawConcentrationProfile(reactorType, reactionOrder, rateConstant, initialConc, flowRate);
            
            // Sıcaklık grafiğini çiz (izotermal varsayalım)
            drawTemperatureProfile(reactorType, 'isothermal');
        }
        
        function calculateAdvancedReactor() {
            // Gelişmiş hesaplamaları burada yapabilirsiniz
            // Temel hesaplamaları çağıralım ve ek hesaplamaları ekleyelim
            calculateBasicReactor();
            
            // Termodinamik parametreleri al
            const reactionTemp = parseFloat(document.getElementById('reactionTemp').value);
            const reactionPressure = parseFloat(document.getElementById('reactionPressure').value);
            const activationEnergy = parseFloat(document.getElementById('activationEnergy').value);
            const heatOfReaction = parseFloat(document.getElementById('heatOfReaction').value);
            
            // Çalışma modunu al
            const operatingMode = document.getElementById('operatingMode').value;
            
            // Ek sonuçları ekle
            document.getElementById('resultsContent').innerHTML += `
                <p><strong>Reaksiyon Sıcaklığı:</strong> ${reactionTemp} K</p>
                <p><strong>Reaksiyon Basıncı:</strong> ${reactionPressure} bar</p>
                <p><strong>Aktivasyon Enerjisi:</strong> ${activationEnergy} kJ/mol</p>
                <p><strong>Reaksiyon Isısı:</strong> ${heatOfReaction} kJ/mol</p>
                <p><strong>Çalışma Modu:</strong> ${getOperatingModeName(operatingMode)}</p>
            `;
            
            // Adyabatik veya izotermal olmayan durum için sıcaklık profilini güncelle
            drawTemperatureProfile(document.getElementById('reactorType').value, operatingMode);
        }
        
        function calculateEconomics() {
            // Ekonomik parametreleri al
            const capitalCost = parseFloat(document.getElementById('capitalCost').value);
            const operatingCost = parseFloat(document.getElementById('operatingCost').value);
            const rawMaterialCost = parseFloat(document.getElementById('rawMaterialCost').value);
            const productValue = parseFloat(document.getElementById('productValue').value);
            const projectLife = parseFloat(document.getElementById('projectLife').value);
            const discountRate = parseFloat(document.getElementById('discountRate').value) / 100;
            
            // Yıllık üretim miktarını tahmin et (Basitleştirilmiş)
            const targetConversion = parseFloat(document.getElementById('targetConversion').value);
            const flowRate = parseFloat(document.getElementById('flowRate').value);
            
            // Yıllık 8000 saat çalışma varsayalım
            const annualProduction = flowRate * targetConversion * 3600 * 8000 / 1000; // ton/yıl
            
            // Yıllık gelir
            const annualRevenue = annualProduction * productValue;
            
            // Yıllık hammadde maliyeti
            const annualRawMaterialCost = annualProduction / targetConversion * rawMaterialCost;
            
            // Yıllık net nakit akışı
            const annualCashFlow = annualRevenue - annualRawMaterialCost - operatingCost;
            
            // Net Bugünkü Değer hesabı
            let npv = -capitalCost;
            for (let i = 1; i <= projectLife; i++) {
                npv += annualCashFlow / Math.pow(1 + discountRate, i);
            }
            
            // İç Karlılık Oranı (Basitleştirilmiş)
            // Gerçek IRR hesabı için iteratif bir yöntem kullanılmalıdır
            const irr = annualCashFlow / capitalCost;
            
            // Geri ödeme süresi
            const payback = capitalCost / annualCashFlow;
            
            // Yatırımın Geri Dönüş Oranı
            const roi = (annualCashFlow / capitalCost) * 100;
            
            // Ekonomik sonuçları göster
            document.getElementById('economicResults').style.display = 'block';
            document.getElementById('npvValue').textContent = `${npv.toFixed(0)} USD`;
            document.getElementById('irrValue').textContent = `${(irr*100).toFixed(1)}%`;
            document.getElementById('paybackValue').textContent = `${payback.toFixed(1)} yıl`;
            document.getElementById('roiValue').textContent = `${roi.toFixed(1)}%`;
            
            // Temel reaktör hesaplamalarını da yapalım
            calculateBasicReactor();
        }
        
        function drawReactorDiagram(reactorType) {
            const container = document.getElementById('diagramContainer');
            container.innerHTML = '';
            
            // Reaktör şeması için SVG kullanabiliriz
            let svg = '';
            
            switch(reactorType) {
                case 'pfr':
                    svg = `
                        <svg width="400" height="150" viewBox="0 0 400 150">
                            <rect x="50" y="50" width="300" height="50" fill="none" stroke="#007bff" stroke-width="2" />
                            <polygon points="30,75 50,65 50,85" fill="#007bff" />
                            <polygon points="370,75 350,65 350,85" fill="#007bff" />
                            <text x="200" y="85" text-anchor="middle" fill="#333">PFR</text>
                            <text x="20" y="75" text-anchor="end" fill="#333">Giriş</text>
                            <text x="380" y="75" text-anchor="start" fill="#333">Çıkış</text>
                        </svg>
                    `;
                    break;
                case 'cstr':
                    svg = `
                        <svg width="400" height="150" viewBox="0 0 400 150">
                            <circle cx="200" cy="75" r="50" fill="none" stroke="#007bff" stroke-width="2" />
                            <line x1="120" y1="75" x2="150" y2="75" stroke="#007bff" stroke-width="2" />
                            <polygon points="150,75 140,70 140,80" fill="#007bff" />
                            <line x1="200" y1="125" x2="200" y2="150" stroke="#007bff" stroke-width="2" />
                            <polygon points="200,150 195,140 205,140" fill="#007bff" />
                            <text x="200" y="85" text-anchor="middle" fill="#333">CSTR</text>
                            <text x="110" y="75" text-anchor="end" fill="#333">Giriş</text>
                            <text x="200" y="150" text-anchor="middle" dominant-baseline="hanging" fill="#333">Çıkış</text>
                            <!-- Karıştırıcı sembolü -->
                            <line x1="170" y1="60" x2="230" y2="90" stroke="#333" stroke-width="1.5" />
                            <line x1="170" y1="90" x2="230" y2="60" stroke="#333" stroke-width="1.5" />
                        </svg>
                    `;
                    break;
                case 'pbr':
                    svg = `
                        <svg width="400" height="150" viewBox="0 0 400 150">
                            <rect x="50" y="50" width="300" height="50" fill="none" stroke="#007bff" stroke-width="2" />
                            <polygon points="30,75 50,65 50,85" fill="#007bff" />
                            <polygon points="370,75 350,65 350,85" fill="#007bff" />
                            <text x="200" y="85" text-anchor="middle" fill="#333">PBR</text>
                            <text x="20" y="75" text-anchor="end" fill="#333">Giriş</text>
                            <text x="380" y="75" text-anchor="start" fill="#333">Çıkış</text>
                            <!-- Katalizör parçacıkları -->
                            <circle cx="100" cy="65" r="3" fill="#666" />
                            <circle cx="120" cy="75" r="3" fill="#666" />
                            <circle cx="140" cy="65" r="3" fill="#666" />
                            <circle cx="160" cy="75" r="3" fill="#666" />
                            <circle cx="180" cy="65" r="3" fill="#666" />
                            <circle cx="200" cy="75" r="3" fill="#666" />
                            <circle cx="220" cy="65" r="3" fill="#666" />
                            <circle cx="240" cy="75" r="3" fill="#666" />
                            <circle cx="260" cy="65" r="3" fill="#666" />
                            <circle cx="280" cy="75" r="3" fill="#666" />
                            <circle cx="300" cy="65" r="3" fill="#666" />
                        </svg>
                    `;
                    break;
                case 'batch':
                    svg = `
                        <svg width="400" height="150" viewBox="0 0 400 150">
                            <rect x="150" y="25" width="100" height="100" rx="5" ry="5" fill="none" stroke="#007bff" stroke-width="2" />
                            <line x1="200" y1="25" x2="200" y2="10" stroke="#007bff" stroke-width="2" />
                            <circle cx="200" cy="10" r="5" fill="#007bff" />
                            <text x="200" y="75" text-anchor="middle" fill="#333">Batch</text>
                            <text x="250" y="30" text-anchor="start" fill="#333">Karıştırıcı</text>
                            <!-- Karıştırıcı mili -->
                            <line x1="200" y1="25" x2="200" y2="100" stroke="#333" stroke-width="1.5" />
                            <!-- Karıştırıcı pervanesi -->
                            <line x1="180" y1="80" x2="220" y2="80" stroke="#333" stroke-width="1.5" />
                            <line x1="190" y1="70" x2="210" y2="90" stroke="#333" stroke-width="1.5" />
                            <line x1="190" y1="90" x2="210" y2="70" stroke="#333" stroke-width="1.5" />
                        </svg>
                    `;
                    break;
            }
            
            container.innerHTML = svg;
        }
        
        function drawConversionProfile(reactorType, reactionOrder, k, ca0, fa0) {
            const ctx = document.getElementById('conversionCanvas').getContext('2d');
            
            // Önceki grafik varsa temizle
            if (conversionChart) {
                conversionChart.destroy();
            }
            
            // X ekseni için değerler (reaktör pozisyonu veya zaman)
            const dataPoints = 100;
            const data = [];
            
            // Reaktör boyutu veya zaman ölçeği
            let maxValue = 0;
            
            if (reactorType === 'pfr' || reactorType === 'pbr') {
                // Reaktör uzunluğu boyunca dönüşüm profilini hesapla
                for (let i = 0; i <= dataPoints; i++) {
                    const z = i / dataPoints; // Normalize edilmiş pozisyon
                    let conversion = 0;
                    
                    if (reactionOrder === 1) {
                        // Birinci derece: -ln(1-X) = k*t
                        conversion = 1 - Math.exp(-k * z * 5); // 5 birim uzunluk varsayalım
                    } else if (reactionOrder === 2) {
                        // İkinci derece: X/(1-X) = k*CA0*t
                        conversion = (k * ca0 * z * 5) / (1 + k * ca0 * z * 5);
                    } else {
                        // Sıfırıncı derece: X = k*t/CA0 (X < 1)
                        conversion = Math.min(1, k * z * 5 / ca0);
                    }
                    
                    data.push({
                        position: z * 5, // 5 metre uzunluk varsayalım
                        conversion: conversion
                    });
                }
                maxValue = 5; // 5 metre
                
            } else if (reactorType === 'cstr') {
                // CSTR için dönüşüm sabit, ancak çoklu CSTR serilerini simüle edebiliriz
                const numCSTR = 10; // 10 adet CSTR serisi varsayalım
                
                for (let i = 0; i <= numCSTR; i++) {
                    let conversion = 0;
                    
                    if (reactionOrder === 1) {
                        // N adet CSTR için
                        const tauTotal = 5; // Toplam uzay zamanı
                        const tau = tauTotal / numCSTR; // Her CSTR için uzay zamanı
                        
                        // i. reaktördeki dönüşüm formülü
                        if (i > 0) {
                            let sum = 0;
                            for (let j = 1; j <= i; j++) {
                                sum += 1 / Math.pow(1 + k * tau, j);
                            }
                            conversion = 1 - 1 / Math.pow(1 + k * tau, i);
                        }
                    } else if (reactionOrder === 2) {
                        // İkinci derece için yaklaşık formül
                        const tauTotal = 5;
                        const tau = tauTotal / numCSTR;
                        
                        if (i > 0) {
                            conversion = i * k * ca0 * tau / (1 + i * k * ca0 * tau);
                        }
                    } else {
                        // Sıfırıncı derece için yaklaşık formül
                        const tauTotal = 5;
                        const tau = tauTotal / numCSTR;
                        
                        conversion = Math.min(1, i * k * tau / ca0);
                    }
                    
                    data.push({
                        position: i,
                        conversion: conversion
                    });
                }
                maxValue = numCSTR;
                
            } else if (reactorType === 'batch') {
                // Batch reaktör için zaman boyunca dönüşüm
                for (let i = 0; i <= dataPoints; i++) {
                    const t = i / dataPoints * 5; // 5 saatlik süreç varsayalım
                    let conversion = 0;
                    
                    if (reactionOrder === 1) {
                        conversion = 1 - Math.exp(-k * t);
                    } else if (reactionOrder === 2) {
                        conversion = (k * ca0 * t) / (1 + k * ca0 * t);
                    } else {
                        conversion = Math.min(1, k * t / ca0);
                    }
                    
                    data.push({
                        position: t,
                        conversion: conversion
                    });
                }
                maxValue = 5; // 5 saat
            }
            
            // Grafik oluştur
            conversionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.position.toFixed(2)),
                    datasets: [{
                        label: 'Dönüşüm (X)',
                        data: data.map(d => d.conversion),
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: reactorType === 'batch' ? 'Zaman [saat]' : 
                                      reactorType === 'cstr' ? 'CSTR Sayısı' : 'Pozisyon [m]'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Dönüşüm (X)'
                            },
                            min: 0,
                            max: 1
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `${getReactorName(reactorType)} için Dönüşüm Profili`
                        }
                    }
                }
            });
        }
        
        function drawConcentrationProfile(reactorType, reactionOrder, k, ca0, fa0) {
            const ctx = document.getElementById('concentrationCanvas').getContext('2d');
            
            // Önceki grafik varsa temizle
            if (concentrationChart) {
                concentrationChart.destroy();
            }
            
            // X ekseni için değerler (reaktör pozisyonu veya zaman)
            const dataPoints = 100;
            const dataA = [];
            const dataB = [];
            
            // Reaktör boyutu veya zaman ölçeği
            let maxValue = 0;
            
            if (reactorType === 'pfr' || reactorType === 'pbr') {
                // Reaktör uzunluğu boyunca konsantrasyon profilini hesapla
                for (let i = 0; i <= dataPoints; i++) {
                    const z = i / dataPoints; // Normalize edilmiş pozisyon
                    let conversion = 0;
                    
                    if (reactionOrder === 1) {
                        conversion = 1 - Math.exp(-k * z * 5);
                    } else if (reactionOrder === 2) {
                        conversion = (k * ca0 * z * 5) / (1 + k * ca0 * z * 5);
                    } else {
                        conversion = Math.min(1, k * z * 5 / ca0);
                    }
                    
                    const ca = ca0 * (1 - conversion);
                    const cb = ca0 * conversion;
                    
                    dataA.push({
                        position: z * 5,
                        concentration: ca
                    });
                    
                    dataB.push({
                        position: z * 5,
                        concentration: cb
                    });
                }
                maxValue = 5;
                
            } else if (reactorType === 'cstr') {
                const numCSTR = 10;
                
                for (let i = 0; i <= numCSTR; i++) {
                    let conversion = 0;
                    
                    if (reactionOrder === 1) {
                        const tauTotal = 5;
                        const tau = tauTotal / numCSTR;
                        
                        if (i > 0) {
                            conversion = 1 - 1 / Math.pow(1 + k * tau, i);
                        }
                    } else if (reactionOrder === 2) {
                        const tauTotal = 5;
                        const tau = tauTotal / numCSTR;
                        
                        if (i > 0) {
                            conversion = i * k * ca0 * tau / (1 + i * k * ca0 * tau);
                        }
                    } else {
                        const tauTotal = 5;
                        const tau = tauTotal / numCSTR;
                        
                        conversion = Math.min(1, i * k * tau / ca0);
                    }
                    
                    const ca = ca0 * (1 - conversion);
                    const cb = ca0 * conversion;
                    
                    dataA.push({
                        position: i,
                        concentration: ca
                    });
                    
                    dataB.push({
                        position: i,
                        concentration: cb
                    });
                }
                maxValue = numCSTR;
                
            } else if (reactorType === 'batch') {
                for (let i = 0; i <= dataPoints; i++) {
                    const t = i / dataPoints * 5;
                    let conversion = 0;
                    
                    if (reactionOrder === 1) {
                        conversion = 1 - Math.exp(-k * t);
                    } else if (reactionOrder === 2) {
                        conversion = (k * ca0 * t) / (1 + k * ca0 * t);
                    } else {
                        conversion = Math.min(1, k * t / ca0);
                    }
                    
                    const ca = ca0 * (1 - conversion);
                    const cb = ca0 * conversion;
                    
                    dataA.push({
                        position: t,
                        concentration: ca
                    });
                    
                    dataB.push({
                        position: t,
                        concentration: cb
                    });
                }
                maxValue = 5;
            }
            
            // Grafik oluştur
            concentrationChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dataA.map(d => d.position.toFixed(2)),
                    datasets: [
                        {
                            label: 'A Konsantrasyonu [mol/m³]',
                            data: dataA.map(d => d.concentration),
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.1
                        },
                        {
                            label: 'B Konsantrasyonu [mol/m³]',
                            data: dataB.map(d => d.concentration),
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: reactorType === 'batch' ? 'Zaman [saat]' : 
                                      reactorType === 'cstr' ? 'CSTR Sayısı' : 'Pozisyon [m]'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Konsantrasyon [mol/m³]'
                            },
                            min: 0,
                            max: ca0
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `${getReactorName(reactorType)} için Konsantrasyon Profili`
                        }
                    }
                }
            });
        }
        
        function drawTemperatureProfile(reactorType, operatingMode) {
            const ctx = document.getElementById('temperatureCanvas').getContext('2d');
            
            // Önceki grafik varsa temizle
            if (temperatureChart) {
                temperatureChart.destroy();
            }
            
            // X ekseni için değerler
            const dataPoints = 100;
            const data = [];
            
            // Varsayılan değerler
            const initialTemp = parseFloat(document.getElementById('reactionTemp').value) || 350;
            const heatOfReaction = parseFloat(document.getElementById('heatOfReaction').value) || -50; // kJ/mol
            
            // Reaktör boyutu veya zaman ölçeği
            let maxValue = 0;
            
            if (operatingMode === 'isothermal') {
                // İzotermal mod - sıcaklık sabit
                for (let i = 0; i <= dataPoints; i++) {
                    const z = i / dataPoints;
                    
                    data.push({
                        position: z * 5,
                        temperature: initialTemp
                    });
                }
                maxValue = 5;
                
            } else if (operatingMode === 'adiabatic') {
                // Adyabatik mod - sıcaklık değişimi (basitleştirilmiş model)
                const ca0 = parseFloat(document.getElementById('initialConcentration').value);
                const cp = 4.2; // Özgül ısı kapasitesi [kJ/(kg·K)]
                const density = 1000; // Yoğunluk [kg/m³]
                const maxConversion = parseFloat(document.getElementById('targetConversion').value);
                
                // Ekzotermik reaksiyon için maksimum sıcaklık artışını hesapla
                const maxTempRise = -heatOfReaction * ca0 * maxConversion / (cp * density);
                
                if (reactorType === 'pfr' || reactorType === 'pbr') {
                    for (let i = 0; i <= dataPoints; i++) {
                        const z = i / dataPoints;
                        // Basitleştirilmiş model: Dönüşüm ile sıcaklık artışını orantılı varsayalım
                        const tempRise = maxTempRise * z;
                        
                        data.push({
                            position: z * 5,
                            temperature: initialTemp + tempRise
                        });
                    }
                    maxValue = 5;
                    
                } else if (reactorType === 'cstr') {
                    const numCSTR = 10;
                    
                    for (let i = 0; i <= numCSTR; i++) {
                        // Her CSTR'de eşit dönüşüm varsayalım
                        const conversionPerCSTR = maxConversion / numCSTR;
                        const tempRisePerCSTR = maxTempRise / numCSTR;
                        
                        data.push({
                            position: i,
                            temperature: initialTemp + tempRisePerCSTR * i
                        });
                    }
                    maxValue = numCSTR;
                    
                } else if (reactorType === 'batch') {
                    for (let i = 0; i <= dataPoints; i++) {
                        const t = i / dataPoints;
                        // Batch reaktörde zamanla dönüşüm artıkça sıcaklık da artar
                        const tempRise = maxTempRise * t;
                        
                        data.push({
                            position: t * 5,
                            temperature: initialTemp + tempRise
                        });
                    }
                    maxValue = 5;
                }
                
            } else if (operatingMode === 'nonisothermal') {
                // İzotermal olmayan mod - soğutmalı
                const coolingMethod = document.getElementById('coolingMethod').value;
                const heatTransferCoeff = parseFloat(document.getElementById('heatTransferCoeff').value);
                const coolantTemp = initialTemp - 20; // Soğutucu sıcaklığı 20 derece düşük varsayalım
                
                // Basitleştirilmiş model: İzotermal ile adyabatik arasında bir davranış
                const ca0 = parseFloat(document.getElementById('initialConcentration').value);
                const cp = 4.2;
                const density = 1000;
                const maxConversion = parseFloat(document.getElementById('targetConversion').value);
                
                // Maksimum adyabatik sıcaklık artışı
                const maxAdiabaticTempRise = -heatOfReaction * ca0 * maxConversion / (cp * density);
                
                // Soğutma etkinliği (0-1 arası)
                const coolingEfficiency = 0.7;
                
                if (reactorType === 'pfr' || reactorType === 'pbr') {
                    for (let i = 0; i <= dataPoints; i++) {
                        const z = i / dataPoints;
                        // İzotermal olmayan davranış: Adyabatik artış * (1 - soğutma etkinliği)
                        const tempRise = maxAdiabaticTempRise * z * (1 - coolingEfficiency);
                        
                        data.push({
                            position: z * 5,
                            temperature: initialTemp + tempRise
                        });
                    }
                    maxValue = 5;
                    
                } else if (reactorType === 'cstr') {
                    const numCSTR = 10;
                    
                    for (let i = 0; i <= numCSTR; i++) {
                        // Her CSTR için soğutmalı sıcaklık artışı
                        const tempRisePerCSTR = (maxAdiabaticTempRise / numCSTR) * (1 - coolingEfficiency);
                        
                        data.push({
                            position: i,
                            temperature: initialTemp + tempRisePerCSTR * i
                        });
                    }
                    maxValue = numCSTR;
                    
                } else if (reactorType === 'batch') {
                    for (let i = 0; i <= dataPoints; i++) {
                        const t = i / dataPoints;
                        // Batch reaktörde soğutmalı sıcaklık profili
                        const maxTemp = initialTemp + maxAdiabaticTempRise * 0.5; // Maksimum sıcaklık
                        const tempProfile = maxTemp - (maxTemp - initialTemp) * Math.exp(-3 * t); // Isınma fazı
                        const coolingPhase = maxTemp - (maxTemp - initialTemp) * (t - 0.5) / 0.5; // Soğuma fazı
                        
                        let temp;
                        if (t < 0.5) {
                            temp = tempProfile;
                        } else {
                            temp = Math.max(initialTemp, coolingPhase);
                        }
                        
                        data.push({
                            position: t * 5,
                            temperature: temp
                        });
                    }
                    maxValue = 5;
                }
            }
            
            // Grafik oluştur
            temperatureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.position.toFixed(2)),
                    datasets: [{
                        label: 'Sıcaklık [K]',
                        data: data.map(d => d.temperature),
                        borderColor: 'rgb(255, 159, 64)',
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: reactorType === 'batch' ? 'Zaman [saat]' : 
                                      reactorType === 'cstr' ? 'CSTR Sayısı' : 'Pozisyon [m]'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Sıcaklık [K]'
                            },
                            min: Math.max(initialTemp - 50, 273)
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `${getReactorName(reactorType)} için Sıcaklık Profili (${getOperatingModeName(operatingMode)})`
                        }
                    }
                }
            });
        }
        
        function getReactorName(code) {
            switch(code) {
                case 'pfr': return 'Plug Flow Reactor (PFR)';
                case 'cstr': return 'Continuous Stirred Tank Reactor (CSTR)';
                case 'pbr': return 'Packed Bed Reactor (PBR)';
                case 'batch': return 'Batch Reactor';
                default: return code;
            }
        }
        
        function getOperatingModeName(code) {
            switch(code) {
                case 'isothermal': return 'İzotermal';
                case 'adiabatic': return 'Adyabatik';
                case 'nonisothermal': return 'İzotermal Olmayan';
                default: return code;
            }
        }
        
        // Sayfa yüklendiğinde input alanlarını güncelle
        document.addEventListener('DOMContentLoaded', updateReactorInputs);
    </script>
</body>
</html>